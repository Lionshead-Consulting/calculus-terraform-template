{
  "provider": {
    "aws": {
      "region": "${var.region}"
    }
  },
  "terraform": [
    {
        "backend": [{
            "s3": {
                "bucket": "%Bucket%",
                "key": "%FunctionName%.tfstate",
                "region": "%Region%"
            }
        }]
    }
  ],
  "resource": [
    {
      "aws_s3_bucket_object": {
        "fnS3": {
          "key": "%FunctionName%.zip",
          "source": "../%FunctionName%.zip",
          "bucket": "${var.bucket}",
          "etag":"${md5(file(\"../%FunctionName%.zip\"))}"
        }
      }
    },
    {
      "aws_lambda_function": {
        "calculus_generated_function": {
          "function_name": "%FunctionName%",
          "role": "${var.role}",
          "runtime": "nodejs6.10",
          "s3_bucket": "%Bucket%",
          "s3_key": "%FunctionName%.zip",
          "s3_object_version": "${aws_s3_bucket_object.fnS3.version_id}",
          "handler": "index.handler",
          "publish": true,
          "memory_size": "${var.memory_size}",
          "timeout": "${var.timeout}",
          "environment": {
            "variables": {
              "NODE_ENV": "${var.NODE_ENV}"
            }
          }
        }
      }
    },
    {
      "aws_lambda_alias": {
        "dev_alias": {
          "name": "dev",
          "description": "Development environment",
          "function_name": "${aws_lambda_function.calculus_generated_function.arn}",
          "function_version": "$LATEST"
        }
      }
    },
    {
      "aws_lambda_alias": {
        "qa_alias": {
          "name": "QA",
          "description": "QA environment",
          "function_name": "${aws_lambda_function.calculus_generated_function.arn}",
          "function_version": "$LATEST"
        }
      }
    },
    {
      "aws_lambda_alias": {
        "preprod_alias": {
          "name": "preprod",
          "description": "PreProd environment",
          "function_name": "${aws_lambda_function.calculus_generated_function.arn}",
          "function_version": "$LATEST"
        }
      }
    },
    {
      "aws_lambda_alias": {
        "prod_alias": {
          "name": "prod",
          "description": "Production environment",
          "function_name": "${aws_lambda_function.calculus_generated_function.arn}",
          "function_version": "$LATEST"
        }
      }
    }
  ]
}
